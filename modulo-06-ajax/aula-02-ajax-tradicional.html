<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX Example with PokeAPI</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      #pokemon {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>AJAX Example with PokeAPI</h1>
    <div id="pokemonsAll"></div>
    <button id="fetchPokemon">Fetch Pokemon</button>
    <div id="pokemon">
        <h2>Pokemon</h2>
        <p>Click the button to fetch a random Pokemon</p>
        <div class="add-button" id="add-button" hidden="true">
            <button id="buttonAddPokemonToList" type="button">Add 2</button>
        </div>
    </div>
    <div id="pokemonsJSON"></div>

    <!-- FORMAS DE CHAMAR A API -->
    <!-- https://pokeapi.co/api/v2/pokemon?limit=-1 (Traz tudo) -->
    <!-- 
        https://pokeapi.co/api/v2/pokemon?offset=0&limit=30 (Traz 30 pokemons) 

        # RESULTADOS:
        -> count: 1118 (total de pokemons)
        -> next: "https://pokeapi.co/api/v2/pokemon?offset=30&limit=30" (próxima página)
        -> previous: null (página anterior)
        -> results: Array(30) (array com 30 pokemons)

        # PROPRIEDADES:
        Cada objeto dentro do array "results" tem as seguintes propriedades:       
        -> count: 1118 (total de pokemons)
        -> next: "https://pokeapi.co/api/v2/pokemon?offset=30&limit=30" (próxima página)
        -> previous: null (página anterior)
        -> results []: quantidade de pokemons (array com 30 pokemons) = "retorna um array" de objetos com os dados de cada pokemon   
                -> name: "bulbasaur"
                -> url: "https://pokeapi.co/api/v2/pokemon/1/"

        
        # CASO 01:
        -> offset=0 (começa do 0)
        -> limit=30 (traz 30 pokemons a partir do offset)

        # CASO 02:
        -> offset=30 (começa do 30)
        -> limit=30 (traz 30 pokemons a partir do offset)

        # CASO 03:
        -> offset=100 (começa do 100)
        -> limit=30 (traz 30 pokemons a partir do offset)
      -->

    <script>
      // Função para buscar dados de todos os Pokémons
      document.addEventListener("DOMContentLoaded", function () {
        fetchPokemonAll();
      });

      const pokemonList = [];

      // Adiciona um evento de clique ao botão com id 'fetchPokemon'
      document
        .getElementById("fetchPokemon")
        .addEventListener("click", fetchPokemon);

      // Carrega o total de Pokémons na página
      async function fetchPokemonAll() {
        try {
          // Faz uma requisição à API do PokeAPI para obter dados de todos os Pokémons
          const response = await fetch("https://pokeapi.co/api/v2/pokemon");
          // Converte a resposta para JSON
          const totalPokemons = await response.json();
          //   const data = await response.json();
          // Chama a função para exibir os dados do Pokémon
          displayPokemonAll(totalPokemons);
          //   displayPokemonJsonFile(totalPokemons);
          //   console.log(totalPokemons);
        } catch (error) {
          // Exibe um erro no console se a requisição falhar
          console.error("Error fetching Pokemon:", error);
        }
      }

      // Função assíncrona para buscar dados do Pokémon
      async function fetchPokemon() {
        try {
          // Faz uma requisição à API do PokeAPI para obter dados do Pokémon 'ditto'

          //   Retorna um objeto com os dados do Pokémon
          //   https://pokeapi.co/api/v2/pokemon/{id or name}/
          //   Precisará validar se o ID é existente na lista de pokemons

          //   Vamos passar um id aleatório
          const response = await fetch(
            // `https://pokeapi.co/api/v2/pokemon/${pokemonId}`
            `https://pokeapi.co/api/v2/pokemon/${Math.floor(
              Math.random() * 1118
            )}`
          );
          // Converte a resposta para JSON
          const data = await response.json();

          //   Validar se há um pokemón com o id passado
          if (data.id) {
            console.log(`Pokemón Encontrado: 
            => ${data.id}
            => ${data.name}`);
            displayPokemon(data);
            // pokemonList.push(data);
          } else {
            console.log("Pokemon não encontrado:", data);
          }

          // Chama a função para exibir os dados do Pokémon
        } catch (error) {
          // Exibe um erro no console se a requisição falhar
          console.log("Error fetching Pokemon");
        }
      }

      // Função para exibir os dados do Pokémon na página
      function displayPokemon(pokemon) {
        
        // Testa se no parametro pokemon tem o atributo id ou name
        // if (!pokemon.id || !pokemon.name) {
        //   pokemonDiv.innerHTML = console.error("Pokemon inválido:", pokemon);
        //   return;
        // }
        // Seleciona o elemento com id 'pokemon'
        const pokemonDiv = document.getElementById("pokemon");
        const addPokemonButton = document.getElementById("buttonAddPokemonToList");
        const divPokemonButton = document.querySelector(".add-button");
        // Define o conteúdo HTML do elemento 'pokemon' com os dados do Pokémon
        pokemonDiv.innerHTML = `
                <h2>${pokemon.name}</h2>
                <img id="${pokemon.id}" src="${pokemon.sprites.front_default}" alt="${pokemon.name}">
                <p>Height: ${pokemon.height}</p>
                <p>Weight: ${pokemon.weight}</p>
                <button onclick="addPokemon(${JSON.stringify(pokemon)})">Add</button>
            `;
        console.log("--------------BOTÃO---------------");
        // addPokemonButton.hidden = false;
        console.log(addPokemonButton);
        console.log("-------------DIV--------------------");
        divPokemonButton.hidden = false;
        console.log(divPokemonButton);
        document
        .getElementById("add-button")
        .addEventListener("click", addPokemon(pokemon));
        console.log("-----------------------------------------");
        console.log("Pokemon:", pokemon);
        console.log("Pokemon List:", pokemonList);
      }

      // Função para exibir o total de Pokémons na página
      function displayPokemonAll(pokemons) {
        // Seleciona o elemento com id 'pokemonsAll'
        const pokemonsAllDiv = document.getElementById("pokemonsAll");

        // Define o conteúdo HTML do elemento 'pokemonsAll' com os dados do número total de Pokemons
        pokemonsAllDiv.innerHTML = `
                <h2>Total de Pokémons: ${pokemons.count}</h2> 
            `; // count é um atributo do objeto "pokemons" (que veio na chamada da função) que contém o número total de Pokémons
        console.log("-----------------------------------------");
        console.log("Total de Pokemons:", pokemons.count);

        // Trabalhar na resposta da API aqui dentro usando .json() para converter a resposta em JSON
        console.log("-----------------------------------------");
        console.log("Exibindo o objeto completo da resposta da API");
        console.log(pokemons);
      }

      //   function displayPokemonJsonFile(pokemons) {
      // Criar um elemento dentro de uma div que recebe o JSON com todos os pokemons (objeto completo)
      //     const pokemonsJSONdiv = document.getElementById("pokemonsJSON");
      //     pokemonsJSONdiv.innerHTML = `
      //             <h2>JSON com todos os Pokémons</h2>
      //             <pre>${JSON.stringify(pokemons, null, 2)}</pre>
      //         `; // JSON.stringify() converte um objeto JavaScript em uma string JSON
      //   }

      console.log("Lista de Pokemons:", pokemonList);

      //   adiciona Pokemon à lista
      function addPokemon(pokemon) {
        // if (pokemonList.length < 5) {
        //   pokemonList.push(pokemon);
        //   //   updatePokemonDisplay();
        // }

        //  .find retorna o primeiro elemento que satisfaça a condição
        const pokemonId = pokemonList.find(p => p.id === pokemon);
        console.log("---------------POKEMON ID---------------------");
        console.log(pokemonId)
        console.log("-----------------------------------------");
            if (pokemon) {
                console.log('Pokemon added:', pokemon);
                console.log('Current Pokemon List:', pokemonList);
            } else {
                console.error('Pokemon not found:', pokemonId);
            }

        // console.log("Pokemon added:", pokemon);
        // console.log("Current Pokemon List:", pokemonList);
      }

      function updatePokemonDisplay() {
        const pokemonDiv = document.getElementById("pokemon");
        pokemonDiv.innerHTML = pokemonList
          .map(
            (pokemon, index) => `
            <div>
              <h2>${pokemon.name}</h2>
              <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}">
              <p>Height: ${pokemon.height}</p>
              <p>Weight: ${pokemon.weight}</p>
              <button onclick="swapPokemon(${index})">Swap</button>
            </div>
          `
          )
          .join("");
        if (pokemonList.length === 5) {
          pokemonDiv.innerHTML += `
          <button onclick="resetPokemon()">Reset</button>
          `;
        }
      }

      //   const pokemonNames = [];

      //   async function fetchAllPokemonNames() {
      //     try {
      //       const response = await fetch(
      //         "https://pokeapi.co/api/v2/pokemon?limit=1000"
      //       );
      //       const data = await response.json();
      //       data.results.forEach((pokemon) => pokemonNames.push(pokemon.name));
      //     } catch (error) {
      //       console.error("Error fetching all Pokemon names:", error);
      //     }
      //   }

      //   fetchAllPokemonNames();

      //   function createAutocompleteInput(index) {
      //     const input = document.createElement("input");
      //     input.setAttribute("type", "text");
      //     input.setAttribute("placeholder", "Enter Pokemon name");
      //     input.addEventListener("input", function () {
      //       const suggestions = pokemonNames.filter((name) =>
      //         name.toLowerCase().startsWith(this.value.toLowerCase())
      //       );
      //       showSuggestions(this, suggestions, index);
      //     });
      //     return input;
      //   }

      //   function showSuggestions(input, suggestions, index) {
      //     let suggestionBox = input.nextElementSibling;
      //     if (!suggestionBox) {
      //       suggestionBox = document.createElement("div");
      //       suggestionBox.classList.add("suggestions");
      //       input.parentNode.appendChild(suggestionBox);
      //     }
      //     suggestionBox.innerHTML = "";
      //     suggestions.forEach((suggestion) => {
      //       const suggestionItem = document.createElement("div");
      //       suggestionItem.textContent = suggestion;
      //       suggestionItem.addEventListener("click", function () {
      //         input.value = suggestion;
      //         suggestionBox.innerHTML = "";
      //         fetchAndSwapPokemon(suggestion, index);
      //       });
      //       suggestionBox.appendChild(suggestionItem);
      //     });
      //   }

      //   function fetchAndSwapPokemon(name, index) {
      //     fetch(`https://pokeapi.co/api/v2/pokemon/${name.toLowerCase()}`)
      //       .then((response) => response.json())
      //       .then((data) => {
      //         pokemonList[index] = data;
      //         updatePokemonDisplay();
      //       })
      //       .catch((error) => {
      //         console.error("Error fetching new Pokemon:", error);
      //       });
      //   }

      //   function updatePokemonDisplay() {
      //     const pokemonDiv = document.getElementById("pokemon");
      //     pokemonDiv.innerHTML = pokemonList
      //       .map(
      //         (pokemon, index) => `
      //       <div>
      //         <h2>${pokemon.name}</h2>
      //         <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}">
      //         <p>Height: ${pokemon.height}</p>
      //         <p>Weight: ${pokemon.weight}</p>
      //         <button onclick="swapPokemon(${index})">Swap</button>
      //         <div class="autocomplete">${
      //           createAutocompleteInput(index).outerHTML
      //         }</div>
      //       </div>
      //     `
      //       )
      //       .join("");
      //     if (pokemonList.length === 5) {
      //       pokemonDiv.innerHTML += `
      //     <button onclick="resetPokemon()">Reset</button>
      //     `;
      //     }
      //   }
      //   function swapPokemon(index) {
      //     const newPokemonName = prompt("Enter the name of the new Pokemon:");
      //     if (newPokemonName) {
      //       fetch(
      //         `https://pokeapi.co/api/v2/pokemon/${newPokemonName.toLowerCase()}`
      //       )
      //         .then((response) => response.json())
      //         .then((data) => {
      //           pokemonList[index] = data;
      //           updatePokemonDisplay();
      //         })
      //         .catch((error) => {
      //           console.error("Error fetching new Pokemon:", error);
      //         });
      //     }
      //   }

      //   function resetPokemon() {
      //     pokemonList = [];
      //     updatePokemonDisplay();
      //   }

      //   document
      //     .getElementById("fetchPokemon")
      //     .addEventListener("click", async () => {
      //       if (pokemonList.length < 5) {
      //         try {
      //           const response = await fetch(
      //             "https://pokeapi.co/api/v2/pokemon/ditto"
      //           );
      //           const data = await response.json();
      //           addPokemon(data);
      //         } catch (error) {
      //           console.error("Error fetching Pokemon:", error);
      //         }
      //       }
      //     });
    </script>
  </body>
</html>
